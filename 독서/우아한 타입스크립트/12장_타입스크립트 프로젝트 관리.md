## 12.1 앰비언트 타입 활용하기

### 1. 앰비언트 타입 선언

#### 앰비언트 타입 선언

.d.ts 확장자를 가진 파일에서는 타입 선언만 가능하고 값을 표현 할 수 없다. 일반적인 선언과 구별하기 위해 .d.ts 파일에서 하는 타입 선언을 앰비언트 타입선언이라고 부른다.

#### 대표적인 앰비언트 타입 선언 활용 사례

타입스크립트는 기본적으로 \*.js 또는 \*.ts 파일만 이해하므로 이 형식이 아닌 파일을 가져올 때 종종 에러가 발생한다. 이 경우 declare 키워드를 사용하여 특정 형식을 모듈로 선언하면 에러를 수정 할 할 수 있게 된다.

자바스크립트로 작성된 라이브러리가 있다면 타입 선언이 존재하지 않는데 이 경우 tsconfig.json 파일에서 any를 사용하지 못하게 설정했다면 빌드되지 않는다.

이 경우 앰비언트 타입 선언을 사용하여 라이브러리 내부 함수와 변수의 타입을 선언하면 타입스크립트는 자동으로 .d.ts 파일을 검색하여 타입검사를 진행하므로 문제없이 컴파일 할 수 있다.

타입스크립트로 작성된 라이브러리도 코드를 따로 컴파일 하지 않도록 하기 위해 자바스크립트 파일과 .d.ts 파일로 배포되는 것이 일반적이다.

타입스크립트로 직접 구현하지 않았더라도 자바스크립트 어딘가에 전역 변수가 정의되어 있는 상황을 타입스크립트에 알릴 때 앰비언트 타입 선언을 사용할 수 있다.

### 2. 앰비언트 타입 선언 시 주의점

타입스크립트로 만드는 라이브러리에는 tsconfig.json의 declaration을 true로 설정하면 타입스크립트 컴파일러가 .d.ts 파일을 자동으로 생성해 주므로 수동으로 해당 파일을 작성할 필요가 없다.

전역으로 타입을 정의하여 사용할 때 동일한 이름의 타입 선언 시 충돌이 발생되어 어떤 타입 선언이 적용될지 알기 어렵고 의도한대로 동작하지 않을 수 있다. 그리고 명시적인 임포트나 익스포트가 없으므로 코드의 의존성 관계가 명확하지 않아 이후 변경할 때 어려울 수 있다.

### 3. 앰비언트 타입 선언을 잘못 사용했을 때의 문제점

.ts 파일 내에 앰비언트 변수 선언 시 앰비언트 선언이 어떤 파일에 포함되어 있는지 파악하기 어려우므로 .d.ts 확장자 파일 내에서 선언해야 한다.

### 4. 앰비언트 타입 활용하기

앰비언트 타입을 선언하면 내장 유틸리티 함수를 사용하는 것처럼 모든 코드 내에서 임포트하지 않고 사용할 수 있다. 

- 자주 사용하는 커스텀 유틸리티 타입을 declare type으로 선언 시 어디서든 쉽게 사용할 수 있다.
- declare module을 사용하면 이미지나 SVG같이 외부로 노출되어 있지 않은 파일을 모듈로 인식해서 사용할 수 있다.
- declare namespace를 통해 process.env로 설정값을 쉽게 불러오고 환경변수의 자동완성 기능을 사용할 수 있다.
- declare global을 이용해 Window 객체의 스코프에서 사용되는 모듈이나 변수를 추가할 수 있다.
### 5. declare와 번들러의 시너지

declare global로 전역 변수를 선언하는 과정과 번들러를 통해 데이터를 주입하는 절차를 함께 활용하면 실제 데이터가 없어서 발생하는 문제를 방지 할 수 있다.

## 12.2 스크립트와 설정 파일 활용하기

### 1. 스크립트 활용하기

아래 스크립트를 이용하면 실시간으로 파일이 변경될 때마다 tsc가 실행되어 에러를 확인 할 수 있다.

```bash
yarn tsc --noEmit --incremental -w
```

아래 스크립트를 이용해 현재 프로젝트의 타입 커버리지와 any를 사용하고 있는 변수의 위치를 확인 할 수 있다.

```bash
npx type-coverage --detail
```
### 2. 설정 파일 활용하기

tsconfig의 incremental 속성을 true로 설정하면 증분 컴파일이 활성화되어 변경된 부분만 컴파일 하게 된다. 모든 대상을 컴파일 하지 않으므로 타입스크립트의 컴파일 속도를 높일 수 있다.

### 3. 에디터 활용하기

VSCode에서 Restart TS server를 실행하면 타입스크립트 서버를 재실행하게 된다.

## 12.3 타입스크립트 마이그레이션

### 1. 타입스크립트 마이그레이션의 필요성

타입스크립트를 기술스택으로 도입하더라도 기존 프로젝트를 꼭 마이그레이션 해야 하는 것은 아니다. 비즈니스 요구 사항의 변화를 반영할 수 있는 새로운 설계를 기반으로 타입을 작성하는 것이 효율적일 수 있고 프로젝트 규모나 여건을 고려하여 신규 또는 기존 프로젝트의 마이그레이션을 고려해야 한다.
### 2. 점진적인 마이그레이션

작은 프로젝트가 아닌 이상 하루아침에 마이그레이션을 완료할 수 없으므로 작은 부분부터 시작해서 점차 범위를 넓혀가야 한다. 다만 데드라인이 없는 프로젝트는 언제 완료될지 모르므로 설정을 풀어놓은 채 마이그레이션을 미루기보다 마이그레이션 우선순위를 대략적으로라도 설정해 두는게 좋다.

### 3. 마이그레이션 진행하기

1. 타입스크립트 개발 환경을 설정하고 컴파일러를 통합한다. tsconfig.json 파일에서 allowJS를 true, noImplicitAny를 false로 설정해야 한다.
2. 자바스크립트 파일을 타입스크립트 파일로 변환한다. 필요한 타입과 인터페이스를 하나씩 정의하며 함수 시그니처를 추가한다.
3. 변환 작업이 끝났다면 설정을 변경하여 타입이 명시되지 않은 부분이 없는지 점검한다.

## 12.4 모노레포

여러 프로젝트를 관리하는 경우 일반적으로 개별 프로젝트마다 레포지토리를 생성하여 관리하는데 각 프로젝트의 공통된 요소가 있다면 통합하여 효율적으로 관리할 수 있다.

### 1. 분산된 구조의 문제점

각각의 레포지토리에서 Jest, 바벨, ESLint, 타입스크립트 등의 설정파일을 별도로 구성해야하고 공통된 기능이 필요할 경우 기능을 복사하여 사용해야 한다. 이 경우 해당 기능에 버그가 발견되거나 수정해야 할 때 프로젝트의 개수만큼 반복적인 수정을 해야 하므로 생선성을 떨어트린다.

### 2. 통합할 수 있는 요소 찾기

프로젝트마다 동일한 기능을 하는 요소를 찾는다. 기능이 비슷하지만 소스코드가 같지 않다면 통합을 위해 일부 수정해야 한다.

### 3. 공통 모듈화로 관리하기

npm과 같은 패키지 관리자를 활용하여 공통 모듈을 생성하고 관리할 수 있다. 새로운 프로젝트를 시작하더라도 모듈을 통해 코드를 재사용 할 수 있고, 특정 기능의 변경이 필요한 경우 해당 모듈의 소스코드만 수정하면 된다.

다만, 공통모듈에 변경이 발생된다면 해당 모듈을 사용하는 프로젝트에서도 추가작업이 필요하고 공통 모듈의 개수가 늘어나면 관리해야 하는 레포지토리도 들어난다.

### 4. 모노레포의 탄생

모노레포란 버전 관리 시스템에서 여러 프로젝트를 하나의 레포지토리로 통합하여 관리하는 소프트웨어 개발 전략으로 개발 환경 설정도 통합 할 수 있고 공통 모듈도 동일한 프로젝트 내에서 관리되므로 별도의 패키지 관리자를 통해 모듈을 게시하지 않아도 된다.

다만 모노레포로 프로젝트를 관리하며 시간이 지나면서 레포지토리가 거대해 질 수 있고 여러 팀의 이해관계가 얽혀있다면 소유권과 권한관리가 복잡해 질 수 있다.
