## 12.1 인증

완벽한 인증이란 없고 누군가 추측하거나 엿들을 수도 있다. 하지만 인증 데이터는 당신이 누구인지 판단하는데 도움이 된다.

### 12.1.1 HTTP의 인증요구/응답 프레임워크

HTTP는 사용자 인증을 하는데 사용되는 인증요구/응답 프레임워크를 제공한다.

웹앱이 HTTP 요청 메시지를 받으면 서버에서 요청을 처리하는 대신에 `인증요구`로 응답 할 수 있고 이 경우 사용자가 다시 요청을 보낼 때 인증 정보를 첨부해야 한다. 인증 정보가 맞지 않으면 서버는 다시 인증 요구를 보내거나 에러를 낼 수 있다.

### 12.1.2 인증 프로토콜과 헤더

HTTP는 필요에 따라 고쳐 쓸 수 있는 제어 헤더를 통해 다른 인증 프로토콜에 맞춰 확장 할 수 있는 프레임워크를 제공한다. 헤더의 형식과 내용은 인증 프로토콜에 따라 달라지며 인증 프로토콜은 HTTP 인증 헤더에 기술되어 있다.

HTTP에는 기본 인증과 다이제스트 인증이라는 공식 인증 프로토콜이 있으며 현대 인증 프로토콜로는 OAuth가 있다.

![기본 인증의 예](attachments/Pasted%20image%2020231022214249.png)

서버가 사용자에게 인증 요구를 보낼 때 WWW-Authenticate 헤더에 어디서 어떻게 인증 할 지를 기술한다. 클라이언트가 인증을 위해 Authorization 헤더에 인증 파라미터를 담아서 보낸다. 인증이 성공되면 정상적인 상태 코드를 반환하고 추가적인 인증 정보를 Authentication-Info 헤더에 기술 할 수 있다.
### 12.1.3 보안 영역

각 리소스마다 다른 접근 조건을 설정하기 위해 WWW-Authenticate 헤더의 realm 지시자를 사용하며 "Corporate Financials"와 같이 접근 영역을 해설 형식으로 기술 할 수도 있고 서버의 호스트명을 넣을 수도 있다.

## 12.2 기본 인증

인증 요구를 받은 브라우저는 사용자에게 계정과 비밀번호를 입력할 수 있는 Form을 열고 브라우저는 사용자가 입력한 정보를 Authorization 헤더 안에 암호화 해서 서버로 다시 보낸다.

### 12.2.2 Base-64 사용자 이름/비밀번호 인코딩

기본 인증은 사용자 이름과 비밀번호를 콜론으로 이어서 합치고 base-64로 인코딩한다. 예를 들어 사용자 이름이 'brian-totty'이고 비밀번호가 'Ow!'라면 'brian-totty:Ow!'을 만들고 이를 base-64로 인코딩하면 'YnJpYW4tdG90dHk6T3ch'를 만든다.

base-64는 어렵지 않게 사용자 이름과 비밀번호 문자를 섞을 수 있으므로 사용자 이름과 비밀번호가 노출되는 문제를 예방 할 수 있다.

### 12.2.3 프락시 인증

프락시 서버를 통해 인증 할 수도 있다. 프락시 서버에서 접근 정책을 중앙 관리 할 수 있으므로 통합적인 접근 제어를 위해 프락시 서버를 사용하면 좋다.

프락시 인증은 웹 서버의 인증과 헤더와 상태코드만 다르고 절차는 같다.

웹 서버 | 프락시 서버
---|---
비인증 상태 코드 : 401 | 비인증 상태 코드 : 407
WWW-Authenticate | Proxy-Authenticate
Authorization | Proxy-Authorization
Authentication-Info | Proxy-Authentication-Info

## 12.3 기본 인증의 보안 결함

기본 인증은 단순하고 편리하지만 안심 할 수 없으므로 SSL 같은 암호 기술과 혼용한다.

- 기본 인증은 사용자 이름과 비밀번호를 쉽게 디코딩 할 수 있는 형식으로 네트워크에 전송한다. base-64 인코딩은 쉽게 디코딩 할 수 있으므로 보안 강화를 위해서는 HTTP 트랜젝션을 SSL로 보내거나 다이제스트 인증 같은 프로토콜을 사용하는 것이 좋다.
- 보안 비밀번호가 복잡한 방식으로 인코딩 되어 있더라도 이 정보를 캡쳐한 다음 원서버에 그대로 보내면 서버에 접근 할 수있다. 기본 인증은 재전송 공격을 예방하기 위한 어떤 일도 하지 않는다.
- 보안에 치명적이지 않은 네트워크에서 인증이 사용되더라도 많은 사용자가 같은 아이디와 비밀번호를 사용하는 경우가 많으므로 다른 사이트 인증에 악용될 수 있다.
- 인증 헤더를 건드리지 않지만 다른 부분을 수정해서 트랙젝션의 본래 의도를 바꿔버리는 프락시가 중간에 개입하는 경우 기본 인증은 정상 동작을 보장하지 않는다.
- 기본 인증은 가짜 서버의 위장에 취약하다.