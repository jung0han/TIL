HTTP 메시지는 많은 프로토콜에 의해 통제된다. 리다이렉션 기술은 클라이언트의 메시지를 명시적으로 요청하지 않은 곳으로 보낼 수 있다.

### 20.1 왜 리다이렉트인가?

웹 콘텐츠는 흔히 여러 장소에 배포되며 리다이렉션 기술을 통해 신뢰 할 수 있는 HTTP 트랜잭션의 수행(특정 위치에서 요청이 실패 할 경우 다른 곳을 이용), 지연 최소화(클라이언트가 가까운 리소스에 접근 가능), 네트워크 대역폭 절약(목적지 서버의 분산)이 가능하다.

### 20.2 리다이렉트 할 곳

리다이렉션은 분산된 콘텐츠를 찾는 것과 함께 로드 벨런싱을 다룬다.

서버, 프락시, 캐시, 게이트웨이는 모두 클라이언트 측에서 보면 서버로 볼 수 있으며 많은 리다이렉션 기법이 이들 모두에서 동작하며 일부 특별히 설계된 리다이렉션 기술은 특정 종단에서만 동작한다.

웹 서버는 IP별로 요청을 다루며 복제된 서버들로 요청을 분산한다는 것은 같은 URL에 대해 최적의 웹 서버로 보내는 것을 의미한다.

프락시는 프로토콜별로 요청을 다루며 이웃의 모든 HTTP 트래픽은 프락시 캐시로 들어가는 것이 이상적이다.
### 20.3 리다이렉션 프로토콜의 개요

브라우저 설정, DNS, TCP/IP 라우팅, 그리고 HTTP는 모두 메시지를 리다이렉트 하는 메커니즘을 제공하며 브라우저 설정은 프록시로 향하는 리다이렉트 트래픽에 대해서만 사용할 수 있다.

### 20.4 일반적인 리다이렉션 방법

#### 20.4.1 HTTP 리다이렉션

웹 서버에서 다른 곳에 요청을 보내라는 의미의 리다이렉트 메시지를 응답 할 수 있으며 HTTP 리다이렉션의 장점 중 하나로 리다이렉트를 하는 서버가 클라이언트의 아이피 주소를 알기 때문에 브라우저와 서버간의 거리를 고려하여 리다이렉션 위치를 선정 할 수 있으며 클라이언트마다 각각 다른 서버로 리다이렉트 할 수 있다.

HTTP 리다이렉션은 상태코드 302와 함께 리다이렉트 메시지를 돌려주면 브라우저는 호스트를 변경하여 리다이렉트 URL에 다시 요청을 보낸다.

```
HTTP/1.0 302 Redirect
Server: ...
Location: http://111.111.11.111/hammers.html
```

다만 클라이언트가 페이지에 접근 할 때마다 두번의 왕복이 필요하고 리다이렉트 위치를 결정 할 때 서버에서 많은 연산을 해야 할 수 있다. 그리고 리다이렉션 서버가 고장나면 사이트에 접근이 불가능하다.

#### 20.4.2 DNS 리다이렉션

DNS는 하나의 주소에 여러 아이피 주소가 존재할 수 있으며 어떤 아이피 주소를 먼저 반환 할 것인지 결정하는 단순한 방법부터 복잡한 방법까지 다양한 방법이 있다.
##### DNS 라운드 로빈
가장 흔하고 단순한 리다이렉션 기법으로 서버에 대한 클라이언트의 상대 위치나 서버의 부하를 고려하지 않고 순서대로 아이피 주소들을 부여하는 방식이다.

```shell
$ nslookup www.cnn.com

Name: cnn.com

Addresses: 207.25.71.5, 207.25.71.6, 207.25.71.7, 207.25.71.8
207.25.71.9, 207.25.71.12, 207.25.71.20, 207.25.71.22, 207.25.71.23
207.25.71.24, 207.25.71.25, 207.25.71.26, 207.25.71.27, 207.25.71.28
207.25.71.29, 207.25.71.30, 207.25.71.82, 207.25.71.199, 207.25.71.245
207.25.71.246

Aliases: www.cnn.com

# 현재는 하나의 DNS 주소에서 여러 주소를 출력하지 않는다.
$ nslookup www.cnn.com

Server:		192.168.1.11
Address:	192.168.1.11#53

Non-authoritative answer:
www.cnn.com	canonical name = cnn-tls.map.fastly.net.
Name:	cnn-tls.map.fastly.net
Address: 146.75.51.5
```
##### 다중 주소와 라운드 로빈 주소 순환
대부분의 DNS 클라이언트는 다중 주소 집합의 첫번째 주소를 사용하므로 대부분의 DNS 서버는 룩업이 끝날 때 마다 주소를 순환시키고 이 주소 순환을 DNS 라운드 로빈이라고 부르기도 한다.
##### DNS 캐싱의 효과
DNS 주소 순환은 부하를 순환 시키지만 DNS 룩업의 결과는 어플, 운영체제, 자식 DNS 서버에 의해 저장되어 재 사용될 수 있으므로 완벽하지 않다. 다만 DNS가 단일 클라이언트의 트랜색션을 각각의 서버에 분산 시키지 않더라도 비슷한 요청을 하는 클라이언트의 수가 어느 이상된다면 부하는 상대적으로 잘 분산 될 것이다.
##### 다른 DNS 기반 리다이렉션 알고리즘
###### 부하 균형 알고리즘
가장 로드가 적은 웹 서버를 목록의 가장 위에 놓는다.
###### 근접 라우팅 알고리즘
웹 서버들의 팜이 지리적으로 분산되어 있을 경우 사용자를 근처의 웹 서버로 보낸다.
###### 결함 마스킹 알고리즘
네트워크의 건강 상태를 모니터링하고 장애를 피해서 요청을 라우팅 할 수 있다.

#### 20.4.3 임의 캐스트 어드레싱

지리적으로 흩어진 웹 서버들이 같은 아이피 주소를 갖고 백본 라우터의 최단거리 라우팅을 활용한다. 이 방식은 각 웹서버에게 자신을 인접한 백본 라우터로 향하는 라우터라고 알리고 웹 서버는 라우터 통신 프로토콜을 이용해 인접한 백본 라우터와 통신하게 된다.

백본 라우터가 임의 캐스트 주소를 목적지로 하는 패킷을 받게 되면 그 아이피 주소를 받을 수 있는 가장 가까운 라우터를 찾게되고 가장 가까운 서버는 자신이 그 주소를 위한 라우터라고 알렸기 때문에 백본 라우터는 그 서버에게 패킷을 보내게 된다.

동일 주소를 가지는 장비 중 가장 가까운 장비 하나만 응답하게 되며 트래픽 분산, 네트워크 이중화, DDoS 피해 최소화, 응답 시간 단축 효과를 얻을 수 있다.

#### 20.4.4 아이피 맥 포워딩

#### 20.4.5 아이피 주소 포워딩

#### 20.4.6 네트워크 구성요소 제어 프로토콜

### 20.5 프락시 리다이렉션 방법

#### 20.5.1 명시적 프라우저 설정
#### 20.5.2 프락시 자동 설정
#### 20.5.3 웹 프락시 자동발견 프로토콜

### 20.6 캐시 리다이렉션 방법

#### 20.6.1 WCCP 리다이렉션

### 20.7 인터넷 캐시 프로토콜

### 20.8 캐시 배열 라우팅 프로토콜

### 20.9 하이퍼텍스트 캐싱 프로토콜

#### 20.9.1 HTCP 인증

#### 20.9.2 캐싱 정책 설정